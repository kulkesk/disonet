# Основная идея

Для создания стабильной распределенной соцсети нужно отказаться от 
так называемых синглтонов - общих для всех клиентов сущностей, 
таких как общий блокчейн или общая база имен пользователей. 
Если нет этого синглтона, то и нечему ломаться. Не понадобится 
придумывать механизмы согласования. У каждого пользователя сети 
будет свой набор блоков данных и они будут просто реплицироваться 
к другому пользователю сети.

# База данных

Блоки могут быть следующих типов:
1. Сообщение или Реакция (лайк, улыбка, голос за, голос против) - текстовый файл в UTF-8.
2. Файл с любым расширением - двоичный файл.

Блок представляет собой текстовый или двоичный файл. Имя файла это yyyy-mm-dd-hh-mm-ss-nnn-i.ext. 
Где nnn - порядковый номер сообщения, а i - номер клиента. 
А расширение файла указывает на его содержимое. 
При таком подходе можно легко обновлять базу данных, просто переместив на любом носителе недостающие файлы. 
Все эти блоки находятся в папке с именем пользователя. А имя пользователя это его открытый ключ. 
Дата обозначает дату изменения сообщения. 
Ведь сообщения редактируемы и обновленное сообщение должно иметь новое имя файла. 
Таким образом можно даже достигнуть версионирования.

Чтобы ускорить работу с этой базой данных, в памяти клиента создаются двоичные деревья. 
Эти деревья могут выгружаться в файлы на диск чтобы ускорить запуск программы и не индексировать базу каждый раз.

# Групповые чаты

Все личные чаты являются групповыми. 
Даже если группа состоит из двух человек, то все равно это группа, в которую могут быть добавлены другие пользователи. 
Группа имеет свой идентификатор.

Для создания общих приватных чатов генерируется секретный ключ с помощью которого шифруются сообщения. 
Чтобы сохранить ключ в секрете он шифруется открытыми ключами участников группы и передается им.
Получив его, они смогут расшифровывать сообщения. 
Таким образом чтобы пригласить кого-нибудь еще в чат - достаточно отправить ему адрес группы и ключ для расшифровки сообщений.

Изначально групповые чаты не существуют. Они образуются путем смешивания сообщений от всех пользователей, отправленных на определенный адрес.
Такой подход позволяет провести персональную модерацию. Остаться в чате и общаться с теми кто нравится, но не видеть сообщения от неугодных людей.

# Ссылка на сообщение

%user_id.file_name - это идентификатор сообщения, на который можно ссылаться в других сообщениях.

user_id - идентификатор пользователя, его открытый ключ

file_name - имя файла сообщения.

Такой простой формат идентификатора сообщений позволит понять кто и когда выдал это сообщение даже без использования вспомогательных средств.

# Формат сообщения

```
published 2022-02-05 17:23:00
modified 2022-02-05 17:24:00
modified 2022-02-05 17:25:00
user_id @afde3254bc21
user_name serg
message_type public_post
content_type text/plain
text кавычка
Публичное сообщение не требуется шифровать.
Оно может состоять из нескольких строк разделенных обычными переводами строки.
<p>Или содержать html-теги</p>
Или применять разметку markdown [@user](@afde)
Весь секрет в том, что парсер видит ключ text и понимает что дальше идет слово выступающее кавычкой, 
состоящее из непробельных симоволов и заканчивающееся переводом строки.
Далее идет многострочный текст.
А заканчивается он только тогда, когда встретится слово "кавычка" написанное строго с новой строки.
Это позволит отказаться от \n и прочих cпециальных последовательностей символов.
Код такого парсера, работающего как конечный автомат, будет очень минималистичен.
кавычка
mention @afde
mention @defe
encrypted false
```

# Несколько клиентов

Один и тот же закрытый ключ можно использовать на нескольких клиентах. 
При запуске клиента он предлагает создать аккаунт либо импортировать ключ. 
При импорте ключа он спрашивает номер устройства.

При именовании файлов в виде yyyy-mm-dd-hh-mm-ss-nnn-i.txt можно запустить 10 клиентов,
которые могут выдавать по 1000 сообщений в секунду.
Может быть при прямом быстром соеднинении удастся построить аудио/видео канал.

# Заметки

Не публичные записи, заметки, должны быть зашифрованы и не обязательны для репликации.
Если не обязательны для репликации, то как они дойдут до получателя?
Опция в клиенте "доставлять чужие сообщения".

# Лента новостей

Для отображения ленты новостей строится дерево отображения.

